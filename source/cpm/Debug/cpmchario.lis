    1 C	//------------------------------------------------------------------------
    2 C	// Copyright (c) 2018, Christopher D. Farrar
    3 C	//------------------------------------------------------------------------
    4 C	// I here grant permission to any and all to copy and use this software for
    5 C	// any purpose as long as my copyright message is retained.
    6 C	//----------------------------------------------------------------------------
    7  	#include <defines.h>
    8 C	//------------------------------------------------------------------------
    9  	#include "chario.h"
   10  	#include "cpmchario.h"
   11  	#include "cpmregisters.h"
   12  	#include "stringio.h"
   13 C	//------------------------------------------------------------------------
   14  	void cpmConsoleCharInReady( void )
   15  	{
   16  	    afregister = consoleCharInReady() << 8;
   17  	}
   18 C	//------------------------------------------------------------------------
   19  	void cpmConsoleCharIn( void )
   20  	{
   21  	    afregister = consoleCharIn() << 8;
   22  	}
   23 C	//------------------------------------------------------------------------
   24  	void cpmConsoleCharOutReady( void )
   25  	{
   26  	    afregister = consoleCharOutReady() << 8;
   27  	}
   28 C	//------------------------------------------------------------------------
   29  	void cpmConsoleCharOut( void )
   30  	{
   31  	    consoleCharOut( bcregister );
   32  	}
   33 C	//------------------------------------------------------------------------
   34  	void cpmConsoleStringOut( void )
   35  	{
   36  	    UINT24 stringP;
   37  	
   38  	    stringP = (UINT24) ( mbregister & 0xFF );
   39  	    stringP <<= 16;
   40  	    stringP += (UINT24) ( bcregister & 0xFFFF );
   41  	
   42  	    consoleStringOut( (char *) stringP );
   43  	}
   44 C	//------------------------------------------------------------------------
   45  	void cpmListCharOutReady( void )
   46  	{
   47  	    afregister = 0xFF00;
   48  	}
   49 C	//------------------------------------------------------------------------
   50  	void cpmListCharOut( void )
   51  	{
   52  	}
   53 C	//------------------------------------------------------------------------
   54  	void cpmReaderCharInReady( void )
   55  	{
   56  	    afregister = 0xFF00;
   57  	}
   58 C	//------------------------------------------------------------------------
   59  	void cpmReaderCharIn( void )
   60  	{
   61  	    int a;
   62  	
   63 C	    /* This routine has been hijacked for an eZ80-space input */
   64  	    a = bcregister;
   65  	    afregister = (*(volatile unsigned char __INTIO *)a) << 8; 
   66  	}
   67 C	//------------------------------------------------------------------------
   68  	void cpmPunchCharOutReady( void )
   69  	{
   70  	    afregister = 0xFF00;
   71  	}
   72 C	//------------------------------------------------------------------------
   73  	void cpmPunchCharOut( void )
   74  	{
   75  	    int a, d;
   76  	
   77 C	    /* This routine has been hijacked for an eZ80-space output */
   78  	    a = bcregister;
   79  	    d = deregister;
   80  	    *(volatile unsigned char __INTIO *)a = d;
   81  	}
   82 C	//------------------------------------------------------------------------
