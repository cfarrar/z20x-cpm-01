    1 C	//------------------------------------------------------------------------
    2 C	// Copyright (c) 2019, Christopher D. Farrar
    3 C	//------------------------------------------------------------------------
    4 C	//#define DEBUG
    5 C	//------------------------------------------------------------------------
    6 C	// I here grant permission to any and all to copy and use this software for
    7 C	// any purpose as long as my copyright message is retained.
    8 C	//------------------------------------------------------------------------
    9  	#include <defines.h>
   10 C	//------------------------------------------------------------------------
   11  	#include "cpmdispatch.h"
   12  	#include "cpmregisters.h"
   13 C	//------------------------------------------------------------------------
   14 C	// files containing bios functions to dispatch to...
   15 C	//------------------------------------------------------------------------
   16  	#include "cpmload.h"
   17  	#include "cpmchario.h"
   18  	#include "cpmdiskio.h"
   19  	#include "cpmtable.h"
   20 C	//------------------------------------------------------------------------
   21  	#ifdef DEBUG
   22 X	#include <stdio.h>
   23 X	#include "stringio.h"
   24  	#endif
   25 C	//------------------------------------------------------------------------
   26  	#ifdef DEBUG
   27 X	static char debugOutput[255];
   28  	#endif
   29 C	//------------------------------------------------------------------------
   30  	typedef void (*functionP) (void);
   31 C	//------------------------------------------------------------------------
   32 C	// biosDispatchTable - contains pointers to bios functions
   33 C	//------------------------------------------------------------------------
   34  	static functionP const biosDispatchTable[] =
   35  	{
   36  	    cpmLoadCcpBdos          // reloads ccp and bdos for bios warm boot
   37  	
   38  	  , cpmConsoleCharInReady
   39  	  , cpmConsoleCharIn
   40  	  , cpmConsoleCharOutReady
   41  	  , cpmConsoleCharOut
   42  	  , cpmConsoleStringOut
   43  	  , cpmListCharOutReady
   44  	  , cpmListCharOut
   45  	  , cpmPunchCharOutReady
   46  	  , cpmPunchCharOut
   47  	  , cpmReaderCharInReady
   48  	  , cpmReaderCharIn
   49  	  , cpmSelectDisk
   50  	  , cpmHomeHead
   51  	  , cpmSetTrack
   52  	  , cpmSetSector
   53  	  , cpmSetDma
   54  	  , cpmReadSector
   55  	  , cpmWriteSector
   56  	  , cpmTranslateSector
   57  	  , cpmSetRamBase        // load disk tables into ram at supplied addr
   58  	};
   59 C	//------------------------------------------------------------------------
   60 C	// adl_biosDispatch - this function dispatches bios calls
   61 C	//------------------------------------------------------------------------
   62  	void adl_biosDispatch( void )
   63  	{
   64  	    UINT8 vector = hlregister & 0xFF;
   65  	
   66  	    biosDispatchTable[vector]();
   67  	}
   68 C	//------------------------------------------------------------------------
